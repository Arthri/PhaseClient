import $ from "jquery";
import Client from "phaseweb/client";
import ElementIdentifiers from "phaseweb/elementidentifiers";
import DiscussionSection from "phaseweb/pagemodel/discussionsection";

class DiscussionSectionEvents {
    private _discussionSection: DiscussionSection;
    private _client: Client;

    constructor(discussionSection: DiscussionSection, client: Client) {
        this._discussionSection = discussionSection;
        this._client = client;
        this.registerEvents();
    }

    private registerEvents(): void {
        this.registerDiscussionListClick();
        this.registerDiscussionAddClick();
        this.registerDiscussionFilterClick();
        this.registerDiscussionFilterChange();
        this.registerDiscussionFilterBlur();
        this.registerDiscussionListHover();
    }

    /**
     * Registers a click on a discussion list element for switching discussions
     */
    private registerDiscussionListClick(): void {
        const self = this;
        $(ElementIdentifiers.DiscussionSection.list).on("mousedown", ElementIdentifiers.DiscussionSection.discussion, function() {
            self._client.switchDiscussion($(this).attr("id").substr(4));
        });
    }

    /**
     * Registers a click on the add discussion icon
     */
    private registerDiscussionAddClick(): void {
        $(ElementIdentifiers.DiscussionSection.addDiscussion).on("click", () => {
            this._client.startCreateNewDiscussion();
        });
    }

    /**
     * Registers a click on the filter discussion icon
     */
    private registerDiscussionFilterClick(): void {
        $(ElementIdentifiers.DiscussionSection.filterDiscussion).on("click", () => {
            $(ElementIdentifiers.DiscussionSection.filterDiscussionInput).css("display", "block");
            $(ElementIdentifiers.DiscussionSection.filterDiscussionInput).focus();
        });
    }

    /**
     * Registers a change in the filter input 
     */
    private registerDiscussionFilterChange(): void {
        const self = this;
        $(ElementIdentifiers.DiscussionSection.filterDiscussionInput).on("input", function(e) {
            self._discussionSection.updateFilter($(this).val());
        });
    }

    /**
     * Registers a change in the filter input 
     */
    private registerDiscussionFilterBlur(): void {
        $(ElementIdentifiers.DiscussionSection.filterDiscussionInput).on("blur", function(e) {
            if ($(this).val().length === 0) {
                $(this).css("display", "none");
            }
        });
    }

    /**
     * Registers when the mouse enters and leaves the discussion list
     */
    private registerDiscussionListHover(): void {
        $(ElementIdentifiers.DiscussionSection.list).on("mouseover", () => {
            this._discussionSection.mouseHovered = true;
        });

        $(ElementIdentifiers.DiscussionSection.list).on("mouseleave", () => {
            this._discussionSection.mouseHovered = false;
        });
    }
}

export default DiscussionSectionEvents;
