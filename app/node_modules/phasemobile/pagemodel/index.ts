import * as $ from "jquery";
import Client from "phasemobile/client";
import DiscussionSection from "phasemobile/pagemodel/discussionsection";
import Swipe from "phasemobile/swipe";
import SwipeDirection from "phasemobile/swipe/direction";
import ElementIdentifiers from "phaseweb/elementidentifiers";
import WebPageModel from "phaseweb/pagemodel";

class PageModel extends WebPageModel {
    private swipe: Swipe;
    private scrollIncrement: number = 0;

    constructor(client: Client) {
        super(client);
        this.discussionSection = new DiscussionSection(client);

        const phaseElem = document.getElementById("phase");
        if (phaseElem !== null) {
            this.swipe = new Swipe(phaseElem);
            this.swipe.addHandler((element, direction) => {
                switch (direction) {
                    case SwipeDirection.LEFT:
                        this.handleSwipeLeft();
                        break;
                    case SwipeDirection.RIGHT:
                        this.handleSwipeRight();
                        break;
                }
            });
        }

        this.discussionSection.setupScroller();
    }

    protected registerEvents(): void {
        super.registerEvents();
        this.registerMessageInputFocus();
    }

    /* Handles mobile swiping to the left */
    private handleSwipeLeft(): void {
        if ($(ElementIdentifiers.DiscussionSection.main).css("display") !== "none") {
            $(ElementIdentifiers.DiscussionSection.main).css("display", "none");
        } else {
            $(ElementIdentifiers.PeopleSection.main).css("display", "block");
        }
    }

    /* Handles mobile swiping to the right */
    private handleSwipeRight(): void {
        if ($(ElementIdentifiers.PeopleSection.main).css("display") !== "none") {
            $(ElementIdentifiers.PeopleSection.main).css("display", "none");
        } else {
            $(ElementIdentifiers.DiscussionSection.main).css("display", "block");
        }
    }

    private registerMessageInputFocus(): void {
        $(window).on("resize", () => {
            this.messageSection.scrollToBottom();
        });
    }
}

export default PageModel;
