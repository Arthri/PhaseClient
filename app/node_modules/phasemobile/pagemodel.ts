import WebPageModel from 'phaseweb/pagemodel';
import Client from 'phasemobile/client';
import Swipe from 'phasemobile/swipe';
import SwipeDirection from 'phasemobile/swipe/direction';
import ElementIdentifiers from 'phaseweb/elementidentifiers';
import * as $ from 'jquery';

class PageModel extends WebPageModel {
    private swipe: Swipe;
    private scrollIncrement: number = 0;

    constructor(client: Client) {
        super(client);

        let phaseElem = document.getElementById('phase');
        if (phaseElem != null) {
            this.swipe = new Swipe(phaseElem);
            this.swipe.addHandler((element, direction) => {
                switch (direction) {
                    case SwipeDirection.LEFT:
                        this.handleSwipeLeft();
                        break;
                    case SwipeDirection.RIGHT:
                        this.handleSwipeRight()
                        break;
                }
            });
        }
    }

    protected registerEvents(): void {
        super.registerEvents();
        this.registerMessageInputFocus();
    }

    public switchSelectedDiscussion(elem: any): void {
        super.switchSelectedDiscussion(elem);
        $(ElementIdentifiers.DiscussionSection.main).css("display", "none");
    }

    /* Handles mobile swiping to the left */
    private handleSwipeLeft(): void {
        if ($(ElementIdentifiers.DiscussionSection.main).css("display") !== "none") {
            $(ElementIdentifiers.DiscussionSection.main).css("display", "none");
        } else {
            $(ElementIdentifiers.PeopleSection.main).css("display", "block");
        }
    }

    /* Handles mobile swiping to the right */
    private handleSwipeRight(): void {
        if ($(ElementIdentifiers.PeopleSection.main).css("display") !== "none") {
            $(ElementIdentifiers.PeopleSection.main).css("display", "none");
        } else {
            $(ElementIdentifiers.DiscussionSection.main).css("display", "block");
        }
    }

    private registerMessageInputFocus(): void {
        $(window).on('resize', () => {
            this.scrollToBottom();
        });
    }
}

export default PageModel;