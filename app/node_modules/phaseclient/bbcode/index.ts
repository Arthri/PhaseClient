import Conversions from "phaseclient/bbcode/conversions";
import Discussion from "phaseclient/discussion";

class BBCode {
    public static convertText(text: string, discussion: Discussion) {
        if (typeof text === "undefined" || text === null) {
            return text;
        }

        for (const conversion of Conversions) {
            if (typeof conversion[1] === "function") {
                conversion[1] = (conversion[1] as () => void).bind(discussion);
            }
            text = text.replace(conversion[0] as RegExp, conversion[1] as string);
        }

        // text = text.replace(/\r?\n/g, "<br />");

        // This only allows "<br />" (new lines) if the new line is not inside a <ul> and/or <li>
        text = text.replace("/(?!(\<ul\>|\<li\>|\<\/li\>).*?)\\n(?!((?!<).)*?(\<\/ul\>|\<\/li\>|\<li\>))/is", " <br />");
        return text;
    }

    public static displayYoutubeVideo(elem) {
        const videoID = elem.attr("data-id");
        const parent = elem.parent();
        elem.remove();
        parent.append(`<iframe width="640" height="360"
                            src="https://www.youtube.com/embed/${videoID}?modestbranding=1&rel=0&autoplay=1&wmode=transparent&theme=light&color=white"
                            frameborder="0" allowfullscreen></iframe>`);
    }
}

export default BBCode;
